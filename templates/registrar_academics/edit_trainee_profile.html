{% extends 'main.html' %}
{% load static %}
{% block title %}Tecade | Edit Trainee Profile{% endblock %}

{% block extra_styles %}
<!-- Bootstrap -->
<link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">

<!-- Font Awesome (CDN) -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

<!-- Ionicons (CDN) -->
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">

<!-- jvectormap -->
<link rel="stylesheet" href="{% static 'plugins/jvectormap/jquery-jvectormap-1.2.2.css' %}">

<!-- AdminLTE main CSS -->
<link rel="stylesheet" href="{% static 'dist/css/AdminLTE.min.css' %}">

<!-- AdminLTE Skins -->
<link rel="stylesheet" href="{% static 'dist/css/skins/_all-skins.min.css' %}">

<!-- HTML5 Shim and Respond.js IE8 support (Only works via HTTP, so CDN is fine) -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
{% endblock %}

{% block content %}
<aside class="main-sidebar">
  <!-- sidebar: style can be found in sidebar.less -->
  <section class="sidebar">
    <!-- Sidebar user panel -->
    <div class="user-panel">
      <div class="pull-left image">
        <img src="{% static 'dist/img/user2-160x160.jpg' %}" class="img-circle" alt="User Image">
      </div>
      <div class="pull-left info">
        <p>Registrar</p>
        <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
      </div>
    </div>

    <!-- Sidebar menu -->
    <ul class="sidebar-menu">
      <li class="header">NAVIGATION</li>

      <li class="active">
        <a href="{% url 'registrar_dashboard' %}">
          <i class="fa fa-dashboard"></i> <span>Dashboard</span>
        </a>
      </li>

      <li>
        <a href="{% url 'trainee_registration' %}">
          <i class="fa fa-user-plus"></i> <span>Register Trainee</span>
        </a>
      </li>

      <li>
        <a href="{% url 'all_trainees' %}">
          <i class="fa fa-users"></i> <span>All Trainees</span>
        </a>
      </li>

      <li>
        <a href="{% url 'all_departments' %}">
          <i class="fa fa-university"></i> <span>Departments</span>
        </a>
      </li>

      <li>
        <a href="{% url 'all_courses' %}">
          <i class="fa fa-book"></i> <span>Courses</span>
        </a>
      </li>

      <li>
        <a href="#">
          <i class="fa fa-bar-chart"></i> <span>Reports</span>
        </a>
      </li>

      <li>
        <a href="#">
          <i class="fa fa-cog"></i> <span>Settings</span>
        </a>
      </li>

      <li>
        <a href="#">
          <i class="fa fa-sign-out"></i> <span>Logout</span>
        </a>
      </li>


      <li>
        <a href="/admin_login/">
          <i class=""></i> <span>Go to Staff Portal</span>
        </a>
      </li>
    </ul>
  </section>
  <!-- /.sidebar -->
</aside>
<div class="content-wrapper">
  <section class="content-header">
    <h1>Edit Trainee Profile</h1>
  </section>

  <section class="content">
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Trainee Information</h3>
      </div>

      <form method="POST" action="" enctype="multipart/form-data">

        {% csrf_token %}
        <div class="box-body">
          <div class="row">
            <!-- Personal Information -->
            <div class="col-md-4 form-group">
              <label>Passport Photo</label><br>
              {% if trainee.passport %}
              <img src="{{ trainee.passport.url }}" alt="Current Passport"
                style="width:100px; height:auto; margin-bottom:10px;">
              {% endif %}
              <input type="file" class="form-control" name="passport_image">
            </div>

            <div class="col-md-4 form-group">
              <label>First Name</label>
              <input type="text" class="form-control" name="first_name" value="{{ trainee.first_name }}" required>
            </div>
            <div class="col-md-4 form-group">
              <label>Middle Name</label>
              <input type="text" class="form-control" name="middle_name" value="{{ trainee.middle_name }}">
            </div>
            <div class="col-md-4 form-group">
              <label>Last Name</label>
              <input type="text" class="form-control" name="last_name" value="{{ trainee.last_name }}" required>
            </div>
            <div class="col-md-4 form-group">
              <label>Age</label>
              <input type="number" class="form-control" name="age" value="{{ trainee.age }}" required>
            </div>

            <!-- Gender Field -->
            <div class="col-md-4 form-group">
              <label>Gender</label>
              <select name="gender" class="form-control" required>
                <option value="">-- Select Gender --</option>
                <option value="Male" {% if trainee.gender=="Male" %}selected{% endif %}>Male</option>
                <option value="Female" {% if trainee.gender=="Female" %}selected{% endif %}>Female</option>
                <option value="Other" {% if trainee.gender=="Other" %}selected{% endif %}>Other</option>
              </select>
            </div>


            <div class="col-md-4 form-group">
              <label>Date of Admission</label>
              <input type="date" class="form-control" name="date_of_admission"
                value="{{ trainee.date_of_admission|date:'Y-m-d' }}" required>
            </div>

            <!-- Department -->
            <div class="col-md-6 form-group">
              <label>Department</label>
              <select class="form-control" name="department" id="department" required>
                <option value="" disabled>Select Department</option>
                {% for dept in departments %}
                <option value="{{ dept.id }}" {% if dept.id==trainee.department.id %}selected{% endif %}>{{ dept.name }}
                </option>
                {% endfor %}
              </select>
            </div>

            <!-- Course -->
            <div class="col-md-6 form-group">
              <label>Course</label>
              <select class="form-control" name="course" id="course" required>
                {% for course in courses %}
                <option value="{{ course.id }}" {% if course.id==trainee.course.id %}selected{% endif %}>{{ course.name
                  }}</option>
                {% endfor %}
              </select>
            </div>

            <!-- Level -->


            <!-- Academic Background -->
            <div class="col-md-12">
              <h4><strong>Academic Background</strong></h4>
            </div>
            <div class="col-md-4 form-group">
              <label>KCSE Index Number</label>
              <input type="text" class="form-control" name="kcse_index" value="{{ trainee.kcse_index }}">
            </div>
            <div class="col-md-4 form-group">
              <label>KCSE Grade</label>
              <input type="text" class="form-control" name="kcse_grade" value="{{ trainee.kcse_grade }}">
            </div>
            <div class="col-md-4 form-group">
              <label>KCSE Year</label>
              <input type="number" class="form-control" name="kcse_year" value="{{ trainee.kcse_year }}">
            </div>
            <div class="col-md-4 form-group">
              <label>KCPE Index Number</label>
              <input type="text" class="form-control" name="kcpe_index" value="{{ trainee.kcpe_index }}">
            </div>
            <div class="col-md-4 form-group">
              <label>KCPE Grade</label>
              <input type="text" class="form-control" name="kcpe_grade" value="{{ trainee.kcpe_grade }}">
            </div>
            <div class="col-md-4 form-group">
              <label>KCPE Year</label>
              <input type="number" class="form-control" name="kcpe_year" value="{{ trainee.kcpe_year }}">
            </div>

            <!-- Residential Information -->
            <div class="col-md-12">
              <h4><strong>Residential Information</strong></h4>
            </div>
            <div class="col-md-4 form-group">
              <label>County</label>
              <input type="text" class="form-control" name="county" value="{{ trainee.county }}">
            </div>
            <div class="col-md-4 form-group">
              <label>Sub County</label>
              <input type="text" class="form-control" name="sub_county" value="{{ trainee.sub_county }}">
            </div>
            <div class="col-md-4 form-group">
              <label>Division</label>
              <input type="text" class="form-control" name="division" value="{{ trainee.division }}">
            </div>
            <div class="col-md-4 form-group">
              <label>Location</label>
              <input type="text" class="form-control" name="location" value="{{ trainee.location }}">
            </div>

            <!-- Contact Information -->
            <div class="col-md-12">
              <h4><strong>Contact Information</strong></h4>
            </div>
            <div class="col-md-4 form-group">
              <label>Phone Number</label>
              <input type="text" class="form-control" name="phone" value="{{ trainee.phone }}" required>
            </div>
            <div class="col-md-4 form-group">
              <label>ID Number</label>
              <input type="text" class="form-control" name="id_number" value="{{ trainee.id_number }}" required>
            </div>
            <div class="col-md-4 form-group">
              <label>Email</label>
              <input type="email" class="form-control" name="email" value="{{ trainee.email }}" required>
            </div>

            <!-- Parent/Guardian -->
            <div class="col-md-12">
              <h4><strong>Parent/Guardian Information</strong></h4>
            </div>
            <div class="col-md-4 form-group">
              <label>Parent/Guardian Name</label>
              <input type="text" class="form-control" name="guardian_name" value="{{ trainee.guardian_name }}" required>
            </div>
            <div class="col-md-4 form-group">
              <label>Guardian Phone Number</label>
              <input type="text" class="form-control" name="guardian_phone" value="{{ trainee.guardian_phone }}"
                required>
            </div>
            <div class="col-md-4 form-group">
              <label>Guardian ID Number</label>
              <input type="text" class="form-control" name="guardian_id" value="{{ trainee.guardian_id }}" required>
            </div>

          </div>
        </div>

        <div class="box-footer">
          <button type="submit" class="btn btn-success">Save Changes</button>
        </div>
      </form>
    </div>
  </section>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const deptSelect = document.getElementById("department");
    const courseSelect = document.getElementById("course");

    deptSelect.addEventListener("change", function () {
      const deptId = this.value;
      if (deptId) {
        fetch(`/get-courses/${deptId}/`)
          .then(response => response.json())
          .then(data => {
            courseSelect.innerHTML = '<option value="" disabled>Select Course</option>';
            data.forEach(course => {
              const option = document.createElement("option");
              option.value = course.id;
              option.textContent = course.name;
              courseSelect.appendChild(option);
            });
          });
      }
    });
  });
</script>

{% endblock content %}
{% block extra_scripts %}
<!-- jQuery 2.1.4 -->
<script src="{% static 'plugins/jQuery/jQuery-2.1.4.min.js' %}"></script>

<!-- Bootstrap 3.3.5 -->
<script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>

<!-- FastClick -->
<script src="{% static 'plugins/fastclick/fastclick.min.js' %}"></script>

<!-- AdminLTE App -->
<script src="{% static 'dist/js/app.min.js' %}"></script>

<!-- Sparkline -->
<script src="{% static 'plugins/sparkline/jquery.sparkline.min.js' %}"></script>

<!-- jvectormap -->
<script src="{% static 'plugins/jvectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>
<script src="{% static 'plugins/jvectormap/jquery-jvectormap-world-mill-en.js' %}"></script>

<!-- SlimScroll 1.3.0 -->
<script src="{% static 'plugins/slimScroll/jquery.slimscroll.min.js' %}"></script>

<!-- ChartJS 1.0.1 -->
<script src="{% static 'plugins/chartjs/Chart.min.js' %}"></script>

<!-- AdminLTE dashboard demo (dashboard2.js) -->
<script src="{% static 'dist/js/pages/dashboard2.js' %}"></script>

<!-- AdminLTE for demo purposes -->
<script src="{% static 'dist/js/demo.js' %}"></script>
{% endblock %}