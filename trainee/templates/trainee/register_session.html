{% extends 'trainee/trainee_main.html' %}
{% load static %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<link rel="stylesheet" href="{% static 'dist/css/AdminLTE.min.css' %}">
<link rel="stylesheet" href="{% static 'dist/css/skins/_all-skins.min.css' %}">
<link rel="stylesheet" href="{% static 'plugins/iCheck/flat/blue.css' %}">
<link rel="stylesheet" href="{% static 'plugins/morris/morris.css' %}">
<link rel="stylesheet" href="{% static 'plugins/jvectormap/jquery-jvectormap-1.2.2.css' %}">
<link rel="stylesheet" href="{% static 'plugins/datepicker/datepicker3.css' %}">
<link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker-bs3.css' %}">
<link rel="stylesheet" href="{% static 'plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.13.0/dist/index.css" />

{% endblock %}
{{ block.super }}

{% block breadcrumb %}
  <li><a href="{% url 'trainee:trainee_dashboard' %}"><i class="fa fa-dashboard"></i> Dashboard</a></li>
  <li class="active">Trainee Profile</li>
{% endblock %}

{% block main_content %}
<div class="Profile-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header" style="background-color: #daf8cb;">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
        <h3>
            Trainee ID:
            <small> <strong>{{ trainee.trainee_number }}</strong></small>
        </h3>
       <h2> <p class="text-muted">User Profile {{ trainee.first_name }}
{{ trainee.last_name }}</p></h2>
          </div>
            </div>
        </div>

   </section>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Session Registration</h3>
                </div>
                <div class="card-body">
                    {% if errors %}
                        <div class="alert alert-danger">
                            <ul>
                                {% for error in errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                    
                    {% if warning %}
                        <div class="alert alert-warning">
                            {{ warning }}
                        </div>
                    {% endif %}
                    
                    {% if success %}
                        <div class="alert alert-success">
                            {{ success }}
                        </div>
                    {% endif %}

                    {% if current_session %}
                        <div class="alert alert-info">
                            <h5>Current Active Session: {{ current_session.session_period }}</h5>
                            <p>Start Date: {{ current_session.start_date }} | End Date: {{ current_session.end_date }}</p>
                        </div>
                        
                        {% if not is_registered %}
                            <form method="post">
                                {% csrf_token %}
                                <p>Click the button below to register for the current session:</p>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    Register for Current Session
                                </button>
                            </form>
                        {% else %}
                            <div class="alert alert-success">
                                <i class="fa fa-check-circle"></i> 
                                You are already registered for this session. You can access all portal services.
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="fa fa-exclamation-triangle"></i>
                            No active session found. Please contact administration.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.13.0/dist/index.js" type="module"></script>
<script src="{% static 'plugins/jQuery/jQuery-2.1.4.min.js' %}"></script>
<script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
<script src="{% static 'plugins/fastclick/fastclick.min.js' %}"></script>
<script src="{% static 'dist/js/app.min.js' %}"></script>
<script src="{% static 'plugins/sparkline/jquery.sparkline.min.js' %}"></script>
<script src="{% static 'plugins/jvectormap/jquery-jvectormap-1.2.2.min.js' %}"></script>
<script src="{% static 'plugins/jvectormap/jquery-jvectormap-world-mill-en.js' %}"></script>
<script src="{% static 'plugins/slimScroll/jquery.slimscroll.min.js' %}"></script>
<script src="{% static 'plugins/chartjs/Chart.min.js' %}"></script>
<script src="{% static 'dist/js/pages/dashboard2.js' %}"></script>
<script src="{% static 'dist/js/demo.js' %}"></script>
<script>
  $(document).ready(function () {
    $.getJSON("/api/recent-trainees/", function (data) {
      const list = $('#latest-trainees-list');
      list.empty();

      data.forEach(user => {
        const item = `
    <li>
      <img src="${user.image_url}" alt="User Image">
      <a class="users-list-name" href="/trainee/${user.trainee_number}/profile/">${user.name}</a>
      <span class="users-list-date">${user.date_label}</span>
    </li>
  `;
        list.append(item);
      });
    });
  });
</script>

{% endblock %}