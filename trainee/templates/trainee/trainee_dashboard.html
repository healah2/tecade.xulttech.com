{% extends 'trainee/trainee_main.html' %}
{% load static %}
{% block title %}Tecade | Trainee Dashboard{% endblock %}

{% block extra_styles %}
<!-- Bootstrap -->
<!-- Bootstrap 3.3.5 -->
<link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<!-- Ionicons -->
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<!-- Theme style -->
<link rel="stylesheet" href="{% static 'dist/css/AdminLTE.min.css' static %}">
<!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
<link rel="stylesheet" href="{% static 'dist/css/skins/_all-skins.min.css' static %}">
<!-- iCheck -->
<link rel="stylesheet" href="{% static 'plugins/iCheck/flat/blue.css' static %}">
<!-- Morris chart -->
<link rel="stylesheet" href="{% static 'plugins/morris/morris.css' static %}">
<!-- jvectormap -->
<link rel="stylesheet" href="{% static 'plugins/jvectormap/jquery-jvectormap-1.2.2.css' static %}">
<!-- Date Picker -->
<link rel="stylesheet" href="{% static 'plugins/datepicker/datepicker3.css' static %}">
<!-- Daterange picker -->
<link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker-bs3.css' static %}">
<!-- bootstrap wysihtml5 - text editor -->
<link rel="stylesheet" href="{% static 'plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css' static %}">
<style>
</style>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>

    <![endif]-->
{% endblock %}   
{% block page_title %}Trainee Dashboard{% endblock %}

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <h1>
      Dashboard
      <small>Control panel</small>
    </h1>
     
    <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
      <li class="active">Dashboard</li>
    </ol>
  </section>
{% block main_content %}
  <!-- Main content -->
  <section class="content">
                <!-- Annoying Registration Reminder -->
      {% if not is_registered %}
      <div id="registration-reminder" class="alert alert-warning alert-dismissible" style="position: fixed; top: 60px; right: 20px; z-index: 9999; min-width: 300px;">
          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>
          <h5><i class="icon fas fa-exclamation-triangle"></i> Action Required!</h5>
          You are not registered for the current accademic session. <br>
          <a href="{% url 'trainee:register_session' %}" class="alert-link">Register Now</a> to access all services.
      </div>

      <script>
      // Make the reminder annoying - reappear every 30 seconds if closed
      document.addEventListener('DOMContentLoaded', function() {
          let reminder = document.getElementById('registration-reminder');
          let closeButton = reminder.querySelector('.close');
          
          closeButton.addEventListener('click', function() {
              setTimeout(function() {
                  // Clone and re-append the reminder
                  let newReminder = reminder.cloneNode(true);
                  reminder.parentNode.replaceChild(newReminder, reminder);
                  reminder = newReminder;
                  
                  // Re-attach event listener to new close button
                  reminder.querySelector('.close').addEventListener('click', arguments.callee);
              }, 30000); // 30 seconds
          });
      });
      </script>
      {% endif %}

      <!-- Conditionally show services based on registration status -->
      <div class="row">
          {% if is_registered %}
          <!-- Full access for registered trainees -->
          <div class="col-lg-3 col-6">
              <div class="small-box bg-info">
                  <div class="inner">
                      <h3>Fee Statement</h3>
                      <p>View your fee balance</p>
                  </div>
                  <div class="icon">
                      <i class="fa fa-file-invoice-dollar"></i>
                  </div>
                  <a href="{% url 'trainee:fee_statement' %}" class="small-box-footer">
                      View Statement <i class="fa fa-arrow-circle-right"></i>
                  </a>
              </div>
          </div>
          <!-- Add other services here -->
          {% else %}
          <!-- Limited access for unregistered trainees -->
          <div class="col-12">
              <div class="callout callout-warning">
                  <h5><i class="fa fa-lock"></i> Limited Access</h5>
                  <p>Register for the current session to unlock all portal services including fee statements, course materials, and more.</p>
                  <a href="{% url 'trainee:register_session' %}" class="btn btn-warning">Register Now</a>
              </div>
          </div>
          {% endif %}
      </div>
    <!-- Small boxes (Stat box) -->
    <div class="row">
      <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-aqua">
          <div class="inner">
            <h3>1.</h3>
            <p>Attendance</p>
          </div>
          <div class="icon">
            <i class="ion ion-person-add"></i>
          </div>
          <a href="{% url 'trainee:attendance' %}" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
      </div><!-- ./col -->
      <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-green">
          <div class="inner">
            <h3>2.<sup style="font-size: 20px"></sup></h3>
            <p>Library</p>
          </div>
          <div class="icon">
            <i class="fa fa-book"></i>
          </div>
                <a href="{% url 'trainee:library_detail' trainee_id=user.id %}" class="small-box-footer">
                More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
      </div><!-- ./col -->
      <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-yellow">
          <div class="inner">
            <h3>3.</h3>
            <p>Timetable</p>
          </div>
          <div class="icon">
            <i class="ion ion-stats-bars"></i>
          </div>
          <a href="{% url 'trainee:trainee_timetable' %}" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
      </div><!-- ./col -->
      <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-red">
          <div class="inner">
            <h3>4.</h3>
            <p>Assignments</p>
          </div>
          <div class="icon">
            <i class="fa fa-dashboard"></i>
          </div>
            <a href="{% url 'trainee:assignment_list' trainee.id %}" class="small-box-footer">
                More info <i class="fa fa-arrow-circle-right"></i>
            </a>
        </div>
      </div><!-- ./col -->
    </div><!-- /.row -->
    <!-- Main row -->
    <div class="row">
      <!-- Left col -->
      <section class="col-lg-7 connectedSortable">
        <!-- Custom tabs (Charts with tabs)-->
        <div class="nav-tabs-custom">
          <!-- Tabs within a box -->
          <ul class="nav nav-tabs pull-right">
            <li class="active"><a href="#revenue-chart" data-toggle="tab">Area</a></li>
            <li><a href="#sales-chart" data-toggle="tab">Donut</a></li>
            <li class="pull-left header"><i class="ion ion-stats-bars"></i> Performance Progress</li>
          </ul>
          <div class="tab-content no-padding">
            <!-- Morris chart - Sales -->
            <div class="chart tab-pane active" id="revenue-chart" style="position: relative; height: 300px;"></div>
            <div class="chart tab-pane" id="sales-chart" style="position: relative; height: 300px;"></div>
          </div>
        </div><!-- /.nav-tabs-custom -->

      
        <!-- TO DO List -->
           <div class="lesson-box">
    <div class="box-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <i class="fas fa-calendar-day me-2"></i>
                <h3 class="box-title d-inline-block mb-0">Today's Lessons - {{ today_date }}</h3>
            </div>
        </div>
    </div>
    <div class="box-body">
        {% if today_sessions %}
        <ul class="lesson-list">
            {% for session in today_sessions %}
            <li class="lesson-item {% if session.is_current %}current-lesson{% endif %}">
                <span class="lesson-handle">
                    <i class="fas fa-ellipsis-v"></i>
                    <i class="fas fa-ellipsis-v"></i>
                </span>
                <span class="lesson-time">
                    {{ session.start_time|time }} - {{ session.end_time|time }}
                </span>
                <div class="lesson-title">
                    {{ session.title }}
                    <div class="lesson-type">
                        {{ session.session_type }} - {{ session.location }}
                    </div>
                </div>
                <span class="lesson-badge badge bg-{% if session.is_current %}info{% else %}secondary{% endif %}">
                    {% if session.is_current %}Current{% else %}Upcoming{% endif %}
                </span>
                <div class="lesson-actions">
                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="tooltip" title="View details">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="box-footer clearfix no-border">
        <div class="empty-lessons">
            <i class="fas fa-calendar-times"></i>
            <h4><strong>No Lessons Today</strong></h4>
            <p>Enjoy your day off! There are no scheduled lessonhghs for today.
              <br>
              Once there is a lesson The system will notify You
            </p>
        </div>
      </div>
        {% endif %}
    </div>
</div><!-- /.box -->
<!-- =================ADDED CHAT AREA======================= -->
<div id="college-chat-app" class="app-wrapper">
  <style>
    .app-wrapper { display:flex; justify-content:center; align-items:center; padding:16px; }
    /* Outer fixed chat card */
    .chat-shell {
      width: 800px; height: 460px;
      background: #ffffff; overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,.12);
      display: grid; grid-template-rows: 48px 1fr;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      position: relative;
    }

    /* Header */
    .chat-header {
      display:flex; align-items:center; gap:10px; padding: 8px 12px;
      background: #3c8DBC;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .me-chip {
      display:flex; align-items:center; gap:10px;
      font-weight: 700; color:#004d99;
    }
    .me-chip .dot {
      width:10px; height:10px; border-radius:50%; background:#4ade80; box-shadow:0 0 0 2px #e6ffed inset;
    }
    .me-name { font-size:14px; }
    .title { margin-left:auto; font-weight:600; color:#f3f5f8; font-size:20px; }

    /* Body split */
    .chat-body {
      display:grid; grid-template-columns: 220px 6px 1fr; min-height:0; /* enable scroll areas */
    }
    /* Left: user list */
    .user-list {
      background: #f7fbff; border-right: 1px solid rgba(0,0,0,.06);
      overflow-y:auto; min-width: 160px;
    }
    .user-search { padding:8px; border-bottom:1px solid rgba(0,0,0,.06); }
    .user-search input{
      width:100%; padding:8px 10px; border:1px solid #cfe4ff; border-radius:10px; outline:none;
      background:#fff; font-size:13px;
    }
    .user-item {
      display:flex; align-items:center; gap:10px; padding:10px 12px; cursor:pointer;
      border-bottom:1px dashed rgba(0,0,0,.06); transition: background .15s ease;
    }
    .user-item:hover { background:#eef6ff; }
    .user-item.active { background:#e3f1ff; }
    .avatar {
      width:30px; height:30px; border-radius:50%; display:grid; place-items:center; font-size:12px; font-weight:700;
      color:#07457a; background: #d6ebff; border:1px solid #bddbff;
      position:relative; overflow:hidden;
    }
    .status-dot {
      position:absolute; right:-1px; bottom:-1px; width:10px; height:10px; border-radius:50%;
      border:2px solid #f7fbff;
    }
    .status-online { background:#22c55e; }
    .status-offline { background:#94a3b8; }
    .user-meta { display:flex; flex-direction:column; }
    .user-name { font-size:13px; color:#0b4f91; font-weight:600; }
    .user-last { font-size:11px; color:#52739a; opacity:.9; max-width:120px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* Draggable divider */
    .divider {
      width:6px; cursor:col-resize; background: transparent; position:relative;
    }
    .divider::after{
      content:""; position:absolute; left:2px; top:0; bottom:0; width:2px; background:rgba(0,0,0,.06);
    }
    .divider.dragging { background:rgba(51,131,235,.08); }
    
    /* Right: chat area */
    .chat-pane {
      position:relative; min-width: 0; /* allow children to shrink */
      display:grid; grid-template-rows: 42px 1fr auto 56px; 
      min-height: 0;
    }

    /* College-themed WhatsApp-like SVG background (light blues) */
    .messages-area {
      position:relative; overflow-y:auto; display:flex; flex-direction: column; min-height: 0; padding:12px 10px 16px 10px;
      background:
        radial-gradient(circle at 15% 20%, rgba(214,235,255,.7), rgba(214,235,255,0) 40%),
        radial-gradient(circle at 85% 30%, rgba(170,214,255,.7), rgba(170,214,255,0) 45%),
        #ffffff;
      /* SVG pattern overlay */
      --svg: url("data:image/svg+xml,%3Csvg width='160' height='160' viewBox='0 0 160 160' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%2372a8e8' stroke-width='1.2' stroke-opacity='0.35'%3E%3Cpath d='M20 30 l12 -6 l12 6 l-12 6 z'/%3E%3C!-- book --%3E%3Cpath d='M110 38 h18 v12 h-18 z m0 0 l-6 6 v12 h24'/%3E%3C!-- notebook --%3E%3Cpath d='M45 85 q10 -18 20 0 q-10 18 -20 0'/%3E%3C!-- hat tassel wave --%3E%3Cpath d='M50 50 l18 0 l0 10 l-18 0 z'/%3E%3Cpath d='M58 50 l10 -6 l10 6 l-10 6 z'/%3E%3C!-- grad cap --%3E%3Cpath d='M132 98 l10 22'/%3E%3Ccircle cx='132' cy='98' r='2' /%3E%3Ccircle cx='142' cy='120' r='2' /%3E%3C!-- pen dots --%3E%3Cpath d='M18 128 l16 -6 l2 6 l-16 6 z'/%3E%3C!-- pencil body --%3E%3Cpath d='M34 122 l6 -2 l-2 6 l-6 2 z'/%3E%3C!-- pencil tip --%3E%3C/g%3E%3C/svg%3E");
      background-image: var(--svg);
      background-repeat: repeat;
      background-size: 180px 180px;
    }

    .convo-header {
      display:flex; align-items:center; gap:4px; padding: 2px 8px;
      background: #9feafd; border-bottom: 1px solid rgba(0,0,0,.06);
      font-size:13px; color:#0b4f91;
    }
    .convo-target { font-weight:700; }
    .convo-status { margin-left:auto; font-weight: bolder; font-size:16px; color:#137400; opacity:95;}

    /* Messages */
    .message { word-wrap: break-word; animation: messageAppear 0.4s ease; max-width:min(75%, 500px); width: fit-content; min-width: 80px; margin:10px 0; padding:12px 16px;  word-break: break-word; border-radius:14px; position:relative; box-sizing: border-box; box-shadow: 0 2px 4px rgba(0,0,0,.05); overflow: hidden;}
    
            @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    
    .message.sent   { margin-left:auto; background:#D6EBFF; border:1px solid #bddbff; border-bottom-right-radius:1px; }
    .message.received{ margin-right:auto; background:#f7fbff; border:1px solid #d7ebff; border-bottom-left-radius:1px;}
    .message .meta { display:flex; justify-content:flex-end; gap:8px; font-size:10px; color:#2f6fb3; opacity:.8; margin-top:4px; }
    .message .author { font-weight:700; font-size:11px; color:#0b4f91; margin-bottom:2px; opacity:.9; }
    .message img.attachment { max-width:180px; max-height:140px; display:block; border-radius:10px; margin-top:6px; }
    .attachments { margin-top:6px; }
    .file-pill {
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 8px; border-radius:10px; border:1px dashed #00C0EF; background:#D6EBFF; font-size:12px;
    }

    /* Typing & notifications */
    .typing-indicator { height: 28px; padding: 0 10px; display:flex; align-items:center; font-size:12px; color:#2f6fb3; }
    .notification-alert {
      position:absolute; top:8px; left:50%; transform:translateX(-50%);
      background:#0ea5e9; color:#fff; padding:6px 10px; border-radius:999px; font-size:12px;
      box-shadow:0 6px 18px rgba(14,165,233,.35); z-index: 5; display:none;
    }

    /* Input bar */
    .chat-input-bar {
      display:flex; position: sticky; bottom: 0;background: #f7fbff; z-index: 10; align-items:center; gap:8px; padding:8px; background:#f7fbff; border-top:1px solid rgba(0,0,0,.06);
    }
    .emoji-trigger, .send-btn, .attach-btn {
      border:none; background:#e6f0ff; padding:8px 10px; border-radius:10px; cursor:pointer; font-size:14px;
      transition: transform .08s ease;
    }
    .emoji-trigger:hover, .send-btn:hover, .attach-btn:hover { transform: translateY(-1px); }
    #message-text {
      flex:1; border:1px solid #cfe4ff; border-radius:12px; padding:10px 12px; outline:none; background:#fff; min-width:0;
    }
    .emoji-container { display:none; position:absolute; bottom:64px; right:12px; background:#fff; border:1px solid #cfe4ff; border-radius:12px; padding:6px; box-shadow:0 6px 18px rgba(0,0,0,.12); }
    .emoji-container.show { display:block; }

    /* Scrollbars */
    .messages-area::-webkit-scrollbar, .user-list::-webkit-scrollbar { width: 8px; }
    .messages-area::-webkit-scrollbar-thumb, .user-list::-webkit-scrollbar-thumb {
      background:#cfe4ff; border-radius:999px;
    }

            .mobile-menu-btn {
            display: none;
            position: absolute;
            top: 12px;
            left: 12px;
            background: #3c8DBC;
            color: white;
            border: none;
            border-radius: 6px;
            width: 40px;
            height: 40px;
            font-size: 20px;
            z-index: 30;
            cursor: pointer;
        }

        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

    /* Small helper */
    .hidden { display:none!important; }


    @media (max-width: 768px) {
    .chat-shell {
        width: 100%;
        height: 100vh;
        border-radius: 0;
    }
    
    .chat-body {
        grid-template-columns: 1fr;
    }
    
    .user-list {
        position: absolute;
        width: 70%;
        height: 100%;
        z-index: 20;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .user-list.visible {
        transform: translateX(0);
    }
    
    .divider {
        display: none;
    }
}

  </style>

  <div class="chat-shell">
    <!-- Header -->
     
    <div class="chat-header">
      <div class="mobile-menu-btn">â˜°</div>
      <div class="me-chip">
        <span class="dot" title="You are online"></span>
        <span class="me-name" id="current-username">User</span>
      </div>
      <div class="title">TeCADE Chat</div>
    </div>

    <!-- Body -->
    <div class="chat-body">
      <!-- Left: users -->
      <aside class="user-list" id="user-list">
        <div class="user-search"><input id="user-filter" placeholder="Search students..." /></div>
        <!-- Users injected here -->
      </aside>

      <!-- Draggable divider -->
      <div class="divider" id="divider" title="Drag to resize"></div>

      <!-- Right: chat -->
      <section class="chat-pane">
        <div class="convo-header">
          <div>Chatting with <span class="convo-target" id="active-contact-name">Select a user</span></div>
          <div class="convo-status" id="active-contact-status">Offline</div>
        </div>

        <!-- Messages -->
        <div class="messages-area message-area" id="messages"></div>

        <!-- Typing -->
        <div class="typing-indicator" id="typing-indicator"></div>

        <!-- Input -->
        <div class="chat-input-bar">
          <button class="emoji-trigger" id="emoji-trigger" type="button">ðŸ˜Š</button>
          <input type="file" id="file-input" class="hidden" multiple>
          <button class="attach-btn" id="attach-btn" type="button">ðŸ“Ž</button>
          <input type="text" id="message-text" placeholder="Type your message...">
          <button class="send-btn" id="send-button" type="button">Send</button>
          <div class="emoji-container" id="emoji-container"></div>
        </div>

        <!-- Toast notification (existing hook class kept) -->
        <div class="notification-alert"><span class="notification-message"></span></div>
      </section>
    </div>

    <!-- Pass current user and conversation ID from Django (unchanged keys) -->
    <script id="user-data" type="application/json">
      {{ user_data|safe }}
    </script>
    <script id="conversation-data" type="application/json">
      { "conversation_id": {{ conversation.id }} }
    </script>
  </div>

  <!-- ========= Chat logic (using your ChatWebSocket logic, embedded here 1:1 so we don't modify backend files) ========= -->
  <script>
  /* ===== Your ChatWebSocket logic (same behavior) ===== */
  class ChatWebSocket {
      constructor() {
          this.socket = null;
          this.currentUser = null;
          this.activeConversation = null;
          this.isTempUser = false;
          this.connect();
      }
      connect() {
          try {
              const userElement = document.getElementById('user-data');
              if (userElement) {
                  this.currentUser = JSON.parse(userElement.textContent);
              } else {
                  this.currentUser = { id: 0, username: 'Anonymous' };
                  this.isTempUser = true;
                  console.warn('No user data found - using anonymous session');
              }
              const wsScheme = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
              this.socket = new WebSocket(`${wsScheme}${window.location.host}/ws/home/`);
              this.socket.onopen = () => console.log('WebSocket connection established');
              this.socket.onmessage = (e) => {
                  const data = JSON.parse(e.data);
                  this.handleMessage(data);
              };
              this.socket.onclose = () => {
                  console.log('WebSocket connection closed');
                  setTimeout(() => this.connect(), 5000);
              };
              this.socket.onerror = (err) => console.error('WebSocket error:', err);
          } catch (error) {
              console.error('WebSocket initialization error:', error);
          }
      }
      handleMessage(data) {
          switch (data.type) {
              case 'chat_message':
                  this.displayNewMessage(data.message);
                  window.__chatUI?.storeIncoming(data.message);
                  break;
              case 'notification':
                  this.showNotification(data.message);
                  break;
              case 'typing':
                  this.updateTypingIndicator(data);
                  break;
              case 'reaction':
                  this.updateMessageReaction(data);
                  break;
          }
      }
      sendMessage(content, conversationId) {
          if (this.socket?.readyState === WebSocket.OPEN) {
              this.socket.send(JSON.stringify({
                  type: 'chat_message',
                  conversation_id: conversationId,
                  content: content
              }));
          }
      }
      sendTypingIndicator(conversationId, isTyping) {
          if (this.socket?.readyState === WebSocket.OPEN) {
              this.socket.send(JSON.stringify({
                  type: 'typing',
                  conversation_id: conversationId,
                  is_typing: isTyping
              }));
          }
      }
      sendReaction(messageId, emoji) {
          if (this.socket?.readyState === WebSocket.OPEN) {
              this.socket.send(JSON.stringify({
                  type: 'reaction',
                  message_id: messageId,
                  emoji: emoji
              }));
          }
      }
      displayNewMessage(message) {
        if (String(message.sender_id) === String(this.currentUser.id)) {
          return; // Skip rendering own messages
        }

          const isMine = String(message.sender_id) === String(this.currentUser.id);
          window.__chatUI?.renderMessage({
            id: message.id,
            author: isMine ? "You" : message.sender_name || "Student",
            side: isMine ? "sent" : "received",
            content: message.content,
            ts: message.timestamp,
            attachments: []
          }, false);
          if (!isMine) window.__chatUI?.playNotificationSound?.();
      }
      showNotification(msg) {
          const el = document.querySelector('.notification-alert');
          if (!el) return;
          el.querySelector('.notification-message').textContent = msg;
          el.style.display = 'block';
          setTimeout(() => {el.style.opacity = '0';setTimeout(() => {
          el.style.display = 'none';
                }, 300);
            }, 3000);
          }
      updateTypingIndicator(data) {
          const typingElement = document.getElementById('typing-indicator');
          if (typingElement) typingElement.textContent = data.is_typing ? `${data.user_name} is typing...` : '';
      }
      updateMessageReaction(data) {
          // no-op here; UI can add if needed
      }
  }
  </script>

  <!-- ========= UI wiring: sidebar, draggable divider, graffiti, session history, files ========= -->
  <script>
    (function(){
      /* Globals */
      const chat = new ChatWebSocket();          // use the same logic
      window.__chat = chat;
      const convData = document.getElementById('conversation-data');
      if (convData) {
        try {
          const parsed = JSON.parse(convData.textContent);
          chat.activeConversation = parsed.conversation_id;
          console.log('[DEBUG] Active conversation set to:', chat.activeConversation);
        } catch (e) { console.error('[ERROR] parse conversation-data:', e); }
      }

      /* DOM refs */
      const meNameEl = document.getElementById('current-username');
      const msgArea  = document.getElementById('messages');
      const typingEl = document.getElementById('typing-indicator');
      const sendBtn  = document.getElementById('send-button');
      const msgInput = document.getElementById('message-text');
      const emojiBtn = document.getElementById('emoji-trigger');
      const emojiBox = document.getElementById('emoji-container');
      const attachBtn= document.getElementById('attach-btn');
      const fileIn   = document.getElementById('file-input');
      const userList = document.getElementById('user-list');
      const filterIn = document.getElementById('user-filter');
      const divider  = document.getElementById('divider');
      const targetNameEl = document.getElementById('active-contact-name');
      const targetStatusEl = document.getElementById('active-contact-status');
      const mobileMenuBtn = document.querySelector('.mobile-menu-btn');

      /* Show current username as the RANDOM NUMBER (per request) */
      try {
        const u = JSON.parse(document.getElementById('user-data').textContent);
        meNameEl.textContent = String(u.id); // show the number
      } catch { /* noop */ }

      /* Emoji picker (simple) */
      const emojis = ['ðŸ˜€','ðŸ˜‚','ðŸ˜','ðŸ‘','â¤ï¸','ðŸ”¥','ðŸŽ‰','ðŸ¤”','ðŸ“š','ðŸŽ“','âœï¸','ðŸ“Ž'];
      emojis.forEach(e => {
        const s = document.createElement('span');
        s.textContent = e; s.style.cursor='pointer'; s.style.fontSize='20px'; s.style.margin='5px';
        s.onclick = () => { msgInput.value += e; msgInput.focus(); };
        emojiBox.appendChild(s);
      });
      emojiBtn.onclick = () => emojiBox.classList.toggle('show');

      /* Sidebar: random users + online status (session-persistent) */
      const CONTACTS_KEY = 'campus_chat_contacts_v1';
      const HISTORY_KEY  = 'campus_chat_history_v1';
      const rng = (min,max)=> Math.floor(Math.random()*(max-min+1))+min;

      function initContacts(){
        const cached = sessionStorage.getItem(CONTACTS_KEY);
        if (cached) return JSON.parse(cached);
        const sample = Array.from({length: 8}).map((_ ,i)=>({
          id: rng(1000,9999),
          name: `Student ${rng(100,999)}`,
          online: Math.random() > 0.4,
          last: 'Tap to open chat'
        }));

        if (window.innerWidth <= 768) {
          userList.classList.remove('visible');
        }
        sessionStorage.setItem(CONTACTS_KEY, JSON.stringify(sample));
        return sample;
      }
      let CONTACTS = initContacts();
      let ACTIVE_CONTACT = null;

      function saveContacts(){ sessionStorage.setItem(CONTACTS_KEY, JSON.stringify(CONTACTS)); }

      /* Message history per contact (session) */
      function getHistory(){
        const raw = sessionStorage.getItem(HISTORY_KEY);
        return raw ? JSON.parse(raw) : {};
      }
      function setHistory(map){ sessionStorage.setItem(HISTORY_KEY, JSON.stringify(map)); }
      function pushToHistory(contactId, msg){
        const map = getHistory();
        map[contactId] = map[contactId] || [];
        map[contactId].push(msg);
        setHistory(map);
      }
      function loadHistory(contactId){ const map = getHistory(); return map[contactId] || []; }

      /* Render contacts */
      function renderContacts(list=CONTACTS){
        // Keep search + header (first child is search)
        const siblings = Array.from(userList.querySelectorAll('.user-item'));
        siblings.forEach(s => s.remove());
        list.forEach(c=>{
          const item = document.createElement('div');
          item.className = 'user-item';
          item.dataset.id = c.id;
          item.innerHTML = `
            <div class="avatar">
              ${String(c.name).split(' ').pop().slice(-2)}
              <span class="status-dot ${c.online ? 'status-online':'status-offline'}"></span>
            </div>
            <div class="user-meta">
              <div class="user-name">${c.name}</div>
              <div class="user-last" id="last-${c.id}">${c.last || ''}</div>
            </div>`;
          item.onclick = ()=>selectContact(c.id);
          userList.appendChild(item);
        });
        // Highlight active
        highlightActive();
      }
      function highlightActive(){
        userList.querySelectorAll('.user-item').forEach(el=>{
          if (ACTIVE_CONTACT && String(el.dataset.id)===String(ACTIVE_CONTACT.id)) el.classList.add('active');
          else el.classList.remove('active');
        });
      }

      /* Select contact */
      function selectContact(id){
        ACTIVE_CONTACT = CONTACTS.find(c=> String(c.id)===String(id));
        highlightActive();
        targetNameEl.textContent = ACTIVE_CONTACT.name;
        targetStatusEl.textContent = ACTIVE_CONTACT.online ? 'Online' : 'Offline';
        // Load history to UI
        msgArea.innerHTML = '';
        const hist = loadHistory(ACTIVE_CONTACT.id);
        hist.forEach(m => renderMessage(m, true));
        // Scroll down
        msgArea.scrollTop = msgArea.scrollHeight;
      }

      /* Messages rendering */
      function renderMessage(m, skipStore){
        const wrap = document.createElement('div');
        wrap.className = `message ${m.side}`;
        const time = new Date(m.ts || Date.now()).toLocaleTimeString();
        wrap.innerHTML = `
          ${m.author ? `<div class="author">${m.author}</div>`:''}
          <div class="content">${escapeHtml(m.content || '')}</div>
          ${Array.isArray(m.attachments) && m.attachments.length ? renderAttachmentsHTML(m.attachments):''}
          <div class="meta"><span>${time}</span></div>
        `;
        msgArea.appendChild(wrap);
        if (!skipStore && ACTIVE_CONTACT) {
          pushToHistory(ACTIVE_CONTACT.id, m);
          updateLastPreview(ACTIVE_CONTACT.id, m);
        }
        msgArea.scrollTop = msgArea.scrollHeight;
      }
      function renderAttachmentsHTML(files){
        const html = files.map(f=>{
          if (f.type.startsWith('image/')) {
            return `<img class="attachment" src="${f.url}" alt="${f.name}">`;
          }
          return `<span class="file-pill">ðŸ“„ <a href="${f.url}" target="_blank">${f.name}</a></span>`;
        }).join(' ');
        return `<div class="attachments">${html}</div>`;
      }
      function updateLastPreview(contactId, m){
        const el = document.getElementById(`last-${contactId}`);
        if (el) {
          const text = m.attachments?.length ? (m.attachments[0].type.startsWith('image/')?'[Photo]':'[File]') : (m.content || '');
          el.textContent = text;
          const c = CONTACTS.find(x=>String(x.id)===String(contactId));
          if (c){ c.last = text; saveContacts(); }
        }
      }
      function escapeHtml(str){
        return String(str)
          .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
          .replaceAll('"','&quot;').replaceAll("'",'&#039;');
      }

      /* Expose for ChatWebSocket on incoming */
      window.__chatUI = {
        renderMessage,
        playNotificationSound(){
          const audio = new Audio('{% static "sounds/Bell-notification-933.wav" %}');
          audio.play().catch(()=>{});
        },
        storeIncoming(msg){
          // If a contact with same sender_id exists, store under them; else store under the active contact
          const target = CONTACTS.find(c => String(c.id) === String(msg.sender_id)) || ACTIVE_CONTACT;
          if (!target) return;
          const payload = {
            id: msg.id,
            author: msg.sender_name || 'Student',
            side: String(msg.sender_id) === String(chat.currentUser?.id) ? 'sent' : 'received',
            content: msg.content, ts: msg.timestamp, attachments: []
          };
          pushToHistory(target.id, payload);
          if (ACTIVE_CONTACT && String(ACTIVE_CONTACT.id) === String(target.id)) {
            // Already rendered in displayNewMessage; just update preview
            updateLastPreview(target.id, payload);
          }
        }
      };

      /* Send message */
      let typingTimeout;
      msgInput.addEventListener('input', ()=>{
        if (chat.activeConversation){
          chat.sendTypingIndicator(chat.activeConversation, true);
          clearTimeout(typingTimeout);
          typingTimeout = setTimeout(()=> chat.sendTypingIndicator(chat.activeConversation, false), 1200);
        }
      });
      sendBtn.addEventListener('click', ()=> doSend());
      msgInput.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter') { e.preventDefault(); doSend(); }
      });

      function doSend(){
        const txt = msgInput.value.trim();
        if (!ACTIVE_CONTACT) { toast('Pick someone to chat with'); return; }
        if (!txt && !fileIn.files.length) return;
        // 1) Text via WS + UI
        if (txt) {
          if (chat.activeConversation) chat.sendMessage(txt, chat.activeConversation);
          renderMessage({ author:'You', side:'sent', content:txt, ts:Date.now(), attachments:[] }, false);
          msgInput.value = '';
          chat.sendTypingIndicator(chat.activeConversation, false);
        }
        // 2) Attachments (frontend only) - create object URLs
        if (fileIn.files.length){
          const atts = Array.from(fileIn.files).map(f=>{
            const url = URL.createObjectURL(f);
            return { name:f.name, url, type:f.type || 'application/octet-stream' };
          });
          renderMessage({ author:'You', side:'sent', content:'', ts:Date.now(), attachments:atts }, false);
          // Optionally notify others textually (since backend file upload is not implemented)
          if (chat.activeConversation) chat.sendMessage(`[Sent ${atts.length} attachment(s)]`, chat.activeConversation);
          fileIn.value = '';
        }
      }

      /* Attachment button */
      attachBtn.onclick = ()=> fileIn.click();

      /* Search filter */
      filterIn.addEventListener('input', ()=>{
        const q = filterIn.value.toLowerCase();
        const filtered = CONTACTS.filter(c=> c.name.toLowerCase().includes(q) || String(c.id).includes(q));
        renderContacts(filtered);
      });

      /* Draggable divider logic */
      (function dividerDrag(){
        let dragging = false;
        let startX = 0;
        let startWidth = 0;
        const MIN = 160, MAX = 360;
        const leftPane = document.querySelector('.user-list');
        divider.addEventListener('mousedown', (e)=>{
          dragging = true; divider.classList.add('dragging');
          startX = e.clientX; startWidth = leftPane.getBoundingClientRect().width;
          document.body.style.userSelect = 'none';
        });
        window.addEventListener('mousemove', (e)=>{
          if (!dragging) return;
          const dx = e.clientX - startX;
          let w = Math.max(MIN, Math.min(MAX, startWidth + dx));
          leftPane.style.width = w + 'px';
        });
        window.addEventListener('mouseup', ()=>{
          if (!dragging) return;
          dragging = false; divider.classList.remove('dragging');
          document.body.style.userSelect = '';
        });
      })();

      /* Toast helper using existing .notification-alert box */
      function toast(msg){
        const box = document.querySelector('.notification-alert');
        if (!box) return;
        box.querySelector('.notification-message').textContent = msg;
        box.style.display = 'block';
        setTimeout(()=> box.style.display='none', 2500);
        chat.showNotification(msg);
      }

      /* Seed UI */
      renderContacts();
      // Auto-select first contact initially
      const first = CONTACTS[0]; if (first) selectContact(first.id);

      mobileMenuBtn.addEventListener('click', () => {
        userList.classList.toggle('visible');
      });

      // Auto-hide typing after inactivity
      let typingHideTimer=null;
      const originalUpdateTyping = chat.updateTypingIndicator.bind(chat);
      chat.updateTypingIndicator = (data)=>{
        originalUpdateTyping(data);
        clearTimeout(typingHideTimer);
        typingHideTimer = setTimeout(()=> { if (typingEl) typingEl.textContent=''; }, 3000);
      };

    })();
  </script>
</div>

<!-- ==============END OF CHAT AREA=================== -->


        <!-- quick email widget -->
        <div class="box box-info">
          <div class="box-header">
            <i class="fa fa-envelope"></i>
            <h3 class="box-title">Talk to department for assistance</h3>
            <!-- tools box -->
            <div class="pull-right box-tools">
              <button class="btn btn-info btn-sm" data-widget="remove" data-toggle="tooltip" title="Remove"><i
                  class="fa fa-times"></i></button>
            </div><!-- /. tools -->
          </div>
          <div class="box-body">
            <form action="#" method="post">
              <div class="form-group">
                <input type="email" class="form-control" name="emailto" placeholder="Email to:">
              </div>
              <div class="form-group">
                <input type="text" class="form-control" name="subject" placeholder="Subject">
              </div>
              <div>
                <textarea class="textarea" placeholder="Message"
                  style="width: 100%; height: 125px; font-size: 14px; line-height: 18px; border: 1px solid #dddddd; padding: 10px;"></textarea>
              </div>
            </form>
          </div>
          <div class="box-footer clearfix">
            <button class="pull-right btn btn-default" id="sendEmail">Send <i
                class="fa fa-arrow-circle-right"></i></button>
          </div>
        </div>

      </section><!-- /.Left col -->
      <!-- right col (We are only adding the ID to make the widgets sortable)-->
      <section class="col-lg-5 connectedSortable">
<!-- =======================Start of Image carousel for Notice=================== -->
<div class="announcement-box">
  <div class="announcement-header">
    <div class="header-title">
      <i class="fa fa-bullhorn"></i>
      <h3>Institutional Notices</h3>
    </div>
    <button class="collapse-btn">
      <i class="fa fa-minus"></i>
    </button>
  </div>

  <div class="announcement-body">
    <div class="announcement-carousel" id="noticeCarousel">
      <div class="carousel-track">
        {% for notice in notices %}
        <div class="announcement-slide">
          {% if notice.memo_image %}
            <div class="announcement-image" style="background-image: url('{{ notice.memo_image.url }}');"></div>
          {% else %}
            <div class="announcement-image default-bg">
              <i class="fa fa-bullhorn"></i>
            </div>
          {% endif %}
          
          <div class="announcement-content">
            <div class="announcement-meta">
              <span class="announcement-date">
                <i class="fa fa-calendar"></i> {{ notice.created_at|date:"M d, Y" }}
              </span>
              <span class="announcement-time">
                <i class="fa fa-clock-o"></i> {{ notice.created_at|time:"H:i" }}
              </span>
            </div>
            <h4 class="announcement-title">{{ notice.title }}</h4>
            <p class="announcement-text">{{ notice.description|truncatewords:20 }}</p>
            <a href="{% url 'trainee:notice_detail' notice.pk %}" class="read-more-btn">
              Read More <i class="fa fa-arrow-right"></i>
            </a>
            
          </div>
        </div>
        {% endfor %}
      </div>
      
      <!-- Arrows -->
      <button class="carousel-arrow prev-arrow"><i class="fa fa-chevron-left"></i></button>
      <button class="carousel-arrow next-arrow"><i class="fa fa-chevron-right"></i></button>
      
      <!-- Dots -->
      <div class="carousel-dots">
        {% for notice in notices %}
        <button class="dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.counter0 }}"></button>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<style>
/* Main Container */
.announcement-box {
  width: 100%;
  max-width: 1000px;
  height: 350px;
  margin: 0 auto 10px;
  background: #fff;
  border: 1px solid #e0e0e0;
  border-radius: 2px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

/* Header Styles */
.announcement-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 15px;
  background: linear-gradient(to right, #3c8DBC, #3a7bd5);
  color: white;
}

.header-title {
  display: flex;
  align-items: center;
  gap: 10px;
}

.announcement-header h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

.collapse-btn {
  background: transparent;
  border: none;
  color: white;
  width: 25px;
  height: 25px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.collapse-btn:hover {
  background: rgba(255,255,255,0.2);
}

/* Carousel Layout */
.announcement-body {
  padding: 0;
  position: relative;
}

.announcement-carousel {
  position: relative;
  overflow: hidden;
}

.carousel-track {
  display: flex;
  transition: transform 0.6s ease-in-out;
}

.announcement-slide {
  flex: 0 0 100%;
  position: relative;
}

/* Image & Overlay */
.announcement-image {
  height: 300px;
  background-size: cover;
  background-position: center;
  position: relative;
}

.announcement-image::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.4), transparent);
}

.default-bg {
  background: linear-gradient(135deg, #00d2ff, #3a7bd5);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

.default-bg i {
  font-size: 40px;
  opacity: 0.8;
}

/* Transparent Content */
.announcement-content {
  position: absolute;
  bottom: 15px;
  left: 15px;
  right: 15px;
  background: rgba(0, 0, 0, 0.4);
  padding: 15px;
  border-radius: 6px;
  color: white;
}

.announcement-meta {
  display: flex;
  gap: 15px;
  margin-bottom: 10px;
  font-size: 13px;
}

.announcement-title {
  margin: 0 0 10px 0;
  font-size: 18px;
  font-weight: 600;
}

.announcement-text {
  font-size: 14px;
  margin-bottom: 15px;
}

.read-more-btn {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  color: #fff;
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
}

.read-more-btn:hover {
  text-decoration: underline;
}

/* Navigation Controls */
.carousel-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 36px;
  height: 36px;
  background: rgba(255,255,255,0.8);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  transition: background 0.2s;
}

.carousel-arrow:hover {
  background: rgba(255,255,255,1);
}

.prev-arrow {
  left: 10px;
}

.next-arrow {
  right: 10px;
}

/* Dots */
.carousel-dots {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.5);
  border: none;
  cursor: pointer;
}

.dot.active {
  background: #39cccc;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const carousel = document.getElementById('noticeCarousel');
  if (!carousel) return;

  const track = carousel.querySelector('.carousel-track');
  const slides = carousel.querySelectorAll('.announcement-slide');
  const prevBtn = carousel.querySelector('.prev-arrow');
  const nextBtn = carousel.querySelector('.next-arrow');
  const dots = carousel.querySelectorAll('.dot');

  let currentIndex = 0;
  const totalSlides = slides.length;
  let intervalId = null;
  const slideInterval = 10000; // 10 seconds

  function updateCarousel() {
    track.style.transform = `translateX(-${currentIndex * 100}%)`;
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentIndex);
    });
  }

  function nextSlide() {
    currentIndex = (currentIndex + 1) % totalSlides;
    updateCarousel();
  }

  function prevSlide() {
    currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
    updateCarousel();
  }

  function goToSlide(index) {
    currentIndex = index;
    updateCarousel();
  }

  function startAutoPlay() {
    intervalId = setInterval(nextSlide, slideInterval);
  }

  function stopAutoPlay() {
    clearInterval(intervalId);
  }

  nextBtn.addEventListener('click', () => { nextSlide(); stopAutoPlay(); startAutoPlay(); });
  prevBtn.addEventListener('click', () => { prevSlide(); stopAutoPlay(); startAutoPlay(); });
  dots.forEach(dot => {
    dot.addEventListener('click', function() {
      goToSlide(parseInt(this.dataset.index));
      stopAutoPlay();
      startAutoPlay();
    });
  });

  carousel.addEventListener('mouseenter', stopAutoPlay);
  carousel.addEventListener('mouseleave', startAutoPlay);

  updateCarousel();
  startAutoPlay();
});
</script>


<!-- End ofimage carouselfor Notice  -->
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <style>
    .progress-container {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
    }
    .progress-box {
      border: 1px solid #e0e0e0;
      border-radius: 5px;
      padding: 15px;
      background: #f9f9f9;
    }
    .progress-stats {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      text-align: center;
    }
    .stat-item {
      padding: 10px;
    }
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #39CCCC;
    }
  </style>
  <div class="progress-container">
    <div class="progress-box">
      <h2 style="color: #39CCCC; margin-top: 0;">My Course Progress</h2>
      <div id="simpleProgressChart" style="height: 250px;"></div>
      <div class="progress-stats">
        <div class="stat-item">
          <div class="stat-value">48</div>
          <div>Total Units</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">10</div>
          <div>Completed</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">21%</div>
          <div>Progress</div>
        </div>
      </div>
    </div>
  </div>

  <script>
  $(document).ready(function() {
    Highcharts.chart('simpleProgressChart', {
      chart: {
        type: 'column'
      },
      title: {
        text: null
      },
      xAxis: {
        categories: ['Nov 2024', 'Mar 2025', 'Jul 2025', 'Nov 2025'],
        title: {
          text: 'Term'
        }
      },
      yAxis: {
        min: 0,
        title: {
          text: 'Units Completed'
        }
      },
      plotOptions: {
        column: {
          color: '#39CCCC',
          borderRadius: 3
        }
      },
      legend: {
        enabled: false
      },
      series: [{
        name: 'Units',
        data: [4, 6, 0, 0],
        dataLabels: {
          enabled: true,
          format: '{y} units'
        }
      }],
      tooltip: {
        headerFormat: '<b>{point.x}</b><br/>',
        pointFormat: 'Completed: {point.y} units'
      }
    });
  });
  </script>


        <!-- Calendar -->
        <div class="box box-solid bg-green-gradient">
          <div class="box-header">
            <i class="fa fa-calendar"></i>
            <h3 class="box-title">Calendar</h3>
            <!-- tools box -->
            <div class="pull-right box-tools">
              <!-- button with a dropdown -->
              <div class="btn-group">
                <button class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown"><i
                    class="fa fa-bars"></i></button>
                <ul class="dropdown-menu pull-right" role="menu">
                  <li><a href="#">Add new event</a></li>
                  <li><a href="#">Clear events</a></li>
                  <li class="divider"></li>
                  <li><a href="#">View calendar</a></li>
                </ul>
              </div>
              <button class="btn btn-success btn-sm" data-widget="collapse"><i class="fa fa-minus"></i></button>
              <button class="btn btn-success btn-sm" data-widget="remove"><i class="fa fa-times"></i></button>
            </div><!-- /. tools -->
          </div><!-- /.box-header -->
          <div class="box-body no-padding">
            <!--The calendar -->
            <div id="calendar" style="width: 100%"></div>
          </div><!-- /.box-body -->
          <div class="box-footer text-black">
            <div class="row">
              <div class="col-sm-6">
                <!-- Progress bars -->
                <div class="clearfix">
                  <span class="pull-left">Task #1</span>
                  <small class="pull-right">90%</small>
                </div>
                <div class="progress xs">
                  <div class="progress-bar progress-bar-green" style="width: 90%;"></div>
                </div>

                <div class="clearfix">
                  <span class="pull-left">Task #2</span>
                  <small class="pull-right">70%</small>
                </div>
                <div class="progress xs">
                  <div class="progress-bar progress-bar-green" style="width: 70%;"></div>
                </div>
              </div><!-- /.col -->
              <div class="col-sm-6">
                <div class="clearfix">
                  <span class="pull-left">Task #3</span>
                  <small class="pull-right">60%</small>
                </div>
                <div class="progress xs">
                  <div class="progress-bar progress-bar-green" style="width: 60%;"></div>
                </div>

                <div class="clearfix">
                  <span class="pull-left">Task #4</span>
                  <small class="pull-right">40%</small>
                </div>
                <div class="progress xs">
                  <div class="progress-bar progress-bar-green" style="width: 40%;"></div>
                </div>
              </div><!-- /.col -->
            </div><!-- /.row -->
          </div>
        </div><!-- /.box -->

      </section><!-- right col -->
    </div><!-- /.row (main row) -->

  </section><!-- /.content -->
</div><!-- /.content-wrapper -->
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'plugins/jQuery/jQuery-2.1.4.min.js' static %}"></script>
<!-- jQuery UI 1.11.4 -->
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge('uibutton', $.ui.button);
</script>

<!-- Bootstrap 3.3.5 -->
<script src="{% static 'bootstrap/js/bootstrap.min.js' static %}"></script>
<!-- Morris.js charts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="{% static 'plugins/morris/morris.min.js' static %}"></script>
<!-- Sparkline -->
<script src="{% static 'plugins/sparkline/jquery.sparkline.min.js' static %}"></script>
<!-- jvectormap -->
<script src="{% static 'plugins/jvectormap/jquery-jvectormap-1.2.2.min.js' static %}"></script>
<script src="{% static 'plugins/jvectormap/jquery-jvectormap-world-mill-en.js' static %}"></script>
<!-- jQuery Knob Chart -->
<script src="{% static 'plugins/knob/jquery.knob.js' static %}"></script>

<!-- =========TO HANDLE THE CHAT HTML ===========-->
<!-- <script src="{% static 'js/chatwebsocket.js' static %}"></script> -->
<!-- <script src="{% static 'js/chatwebsocket.js' %}"></script> -->
 


<!-- daterangepicker -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
<script src="{% static 'plugins/daterangepicker/daterangepicker.js' static %}"></script>
<!-- datepicker -->
<script src="{% static 'plugins/datepicker/bootstrap-datepicker.js' static %}"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="{% static 'plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js' static %}"></script>
<!-- Slimscroll -->
<script src="{% static 'plugins/slimScroll/jquery.slimscroll.min.js' static %}"></script>
<!-- FastClick -->
<script src="{% static 'plugins/fastclick/fastclick.min.js' static %}"></script>
<!-- AdminLTE App -->
<script src="{% static 'dist/js/app.min.js' static %}"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="{% static 'dist/js/pages/dashboard.js' static %}"></script>
<!-- AdminLTE for demo purposes -->
<script src="{% static 'dist/js/demo.js' static %}"></script>

<script>
// Wait until all resources are loaded
$(window).on('load', function() {
    // Only initialize if element exists
    if ($('#courseProgressChart').length) {
        Highcharts.chart('courseProgressChart', {
            chart: { type: 'column' },
            title: { text: null },
            xAxis: {
                categories: ['Nov 2024', 'Mar 2025', 'Jul 2025', 'Nov 2025'],
                title: { text: 'Term' }
            },
            yAxis: {
                min: 0,
                title: { text: 'Units Completed' }
            },
            plotOptions: {
                column: {
                    color: '#39CCCC',
                    borderRadius: 3
                }
            },
            legend: { enabled: false },
            series: [{
                name: 'Units',
                data: [4, 6, 0, 0],
                dataLabels: {
                    enabled: true,
                    format: '{y} units'
                }
            }],
            tooltip: {
                headerFormat: '<b>{point.x}</b><br/>',
                pointFormat: 'Completed: {point.y} units'
            }
        });
    }
});
</script>


{% endblock %}